# Streamlit应用使用说明

## 快速启动

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 启动应用

```bash
cd d:/py/chanlun
streamlit run app/main.py
```

应用将在浏览器中自动打开，默认地址为: http://localhost:8501

## 功能说明

### 界面布局

- **顶部**: 标题区域，显示应用名称
- **左侧边栏**: 参数配置区
  - 股票代码输入
  - 日期范围选择
  - 数据源选择(mootdx/baostock)
  - 数据类型选择(日线/分钟线)
  - 分钟周期选择(仅分钟线数据)
  - 分析按钮
  - 使用说明(可展开)
- **主内容区**: 图表展示区
  - 分析统计信息(指标卡片)
  - 缠论K线图表

### 使用步骤

1. **输入股票代码**
   - 支持格式: 600000, sh.600000, 00700, 00700.HK 等
   - 系统会自动识别交易所

2. **选择日期范围**
   - 开始日期: 默认2024-01-01
   - 结束日期: 默认为上一个工作日或今天

3. **选择数据源**
   - **mootdx**: 支持A股、ETF、港股、指数
   - **baostock**: 仅支持A股，数据更稳定

4. **选择数据类型**
   - 日线: 日K线数据
   - 分钟线: 可选择5/15/30/60分钟周期

5. **点击"开始分析"按钮**
   - 系统会自动获取数据并进行分析
   - 图表将在主区域显示

### 支持的股票代码格式

| 市场类型 | 代码示例 | 说明 |
|---------|---------|------|
| A股（沪市） | 600000 或 sh.600000 | 浦发银行 |
| A股（深市） | 000001 或 sz.000001 | 平安银行 |
| ETF基金 | 588000 或 159915 | 科创ETF、创业板ETF |
| 指数 | 000001 或 399001 | 上证指数、深证成指 |
| 港股 | 00700 或 00700.HK | 腾讯控股 |
| 北交所 | 830799 或 bj.830799 | 安达科技 |

### 数据源选择建议

- **mootdx**:
  - ✅ 支持更多市场(A股/ETF/港股/指数)
  - ✅ 数据更新速度快
  - ⚠️ 连接可能不稳定

- **baostock**:
  - ✅ 数据稳定可靠
  - ✅ 适合A股历史数据
  - ❌ 仅支持A股

### 注意事项

1. **港股和指数数据**: 只能使用mootdx数据源
2. **分钟数据**: 可能有数量限制，建议缩短时间范围
3. **网络要求**: 需要稳定的网络连接获取实时数据
4. **浏览器兼容**: 推荐使用Chrome、Firefox或Edge浏览器

## 高级功能

### 数据缓存

应用使用Streamlit的`@st.cache_data`装饰器缓存分析结果，缓存时间为1小时。相同参数的分析会直接返回缓存结果，提高响应速度。

### 交互式图表

图表使用Plotly渲染，支持以下交互功能:
- 鼠标拖拽缩放
- 滚轮缩放
- 鼠标悬停显示详细信息
- 重置视图按钮
- 自动调整Y轴

### 错误处理

应用内置完善的错误处理机制:
- 参数验证(日期范围、股票代码格式等)
- 数据源兼容性检查
- 网络连接错误提示
- 友好的错误信息展示

## 常见问题

### Q1: 应用启动失败

**A**: 检查是否安装了所有依赖:
```bash
pip install -r requirements.txt
```

### Q2: 数据获取失败

**A**: 
- 检查网络连接
- 尝试切换数据源
- 验证股票代码格式是否正确
- 检查日期范围是否合理

### Q3: 图表不显示

**A**:
- 确保安装了plotly库
- 检查浏览器是否支持HTML5
- 尝试刷新页面

### Q4: 如何导出图表

**A**:
- 点击图表右上角的相机图标可导出为PNG
- 点击下载按钮可导出HTML文件

### Q5: 应用运行缓慢

**A**:
- 减少数据获取的时间范围
- 使用日线数据代替分钟数据
- 清除浏览器缓存

## 技术架构

### 目录结构

```
app/
├── main.py      # Streamlit主应用
├── config.py    # 配置文件
└── utils.py     # 工具函数
```

### 技术栈

- **Streamlit**: Python Web框架
- **Plotly**: 交互式图表库
- **Pandas**: 数据处理
- **NumPy**: 数值计算
- **Mootdx/Baostock**: 数据源

## 开发说明

### 添加新功能

1. 在`app/main.py`中添加UI组件
2. 在`app/utils.py`中添加辅助函数
3. 在`app/config.py`中添加配置参数

### 调试技巧

- 使用`st.write()`输出调试信息
- 检查`st.session_state`中的状态
- 查看浏览器控制台的错误信息

### 性能优化

- 使用`@st.cache_data`缓存计算结果
- 避免在每次渲染时重复计算
- 使用惰性加载大数据集

## 更新日志

### v1.0.0 (2025-12-31)

- ✅ 基础Streamlit应用框架
- ✅ 支持mootdx和baostock双数据源
- ✅ 支持A股、ETF、港股、指数
- ✅ 日线和分钟线数据
- ✅ 交互式Plotly图表
- ✅ 缠论分型分析
- ✅ 完善的错误处理
- ✅ 数据缓存机制

## 联系与反馈

如有问题或建议，请通过以下方式联系:
- 提交Issue
- 发送邮件
- 参与讨论

## 许可证

本项目采用MIT许可证。
